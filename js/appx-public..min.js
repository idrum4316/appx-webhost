/*********************************************************************
 **
 **   public/js/appx-client-utilities.js - Client helper functions
 **
 **   This module contains some helper functions used by the client
 **
 *********************************************************************/
function initialize_localos_session(){var e={cmd:"localosinit",args:[0,0],handler:"localos_init_handler",data:{languageId:appx_session.language.id},authToken:localStorage.authToken}
localos_session.ws.send(JSON.stringify(e))}function initialize_appx_session(e){var a={cmd:"appxinit",args:[e,0],handler:"appx_init_handler",data:null}
appx_session.ws.send(JSON.stringify(a))}function appendMessage(e){debug&&$("#log").prepend(e+"\n\n")}function initialize_localos_directories(e){var a={cmd:"localoscreatedir",args:[e,0],handler:"localos_init_handler",data:null,authToken:localStorage.authToken}
localos_session.ws.send(JSON.stringify(a))}function inject_image(e){var a=window.URL.createObjectURL(new Blob(e))
img=new Image,img.src=a,$("body").prepend(img)}function inject_image2(e){var a=window.URL.createObjectURL(new Blob([toArrayBuffer(e)]))
img=new Image,img.src=a,$("body").prepend(img)}function inject_script(e){var a=document.createElement("script")
a.type="text/javascript",a.text=e,document.head.appendChild(a)}function inject_style(e){$("head").append($("<style>").attr("type","text/css").text(e)),$("body").change()}function logactivity(e){debug&&console.log(e)}function logca(e){debug&&console.log(++testca+"\t"+e)}function toArrayBuffer(e){for(var a=new ArrayBuffer(e.length),o=new Uint8Array(a),t=0;t<e.length;++t)o[t]=e[t]
return a}function localos_enviro_handler(e){if(logactivity("localos_enviro_handler() called..."),appx_session.setProp("clientPublicVersionStr",appxPublicClientVersionStr),appx_session.setProp("clientPublicVersionNum",appxPublicClientVersionNum),e.localConnectorVersionStr?appx_session.setProp("localConnectorVersionStr",e.localConnectorVersionStr):appx_session.setProp("localConnectorVersionStr","Unknown"),e.localConnectorVersionNum?appx_session.setProp("localConnectorVersionNum",e.localConnectorVersionNum):appx_session.setProp("localConnectorVersionNum",99999.999),appx_session.local_environment=e,appx_session.getProp("localConnectorVersionNum")>=60000.19022101&&!appx_session.local_environment.authTokenValid){var a=Math.floor(1e5+9e5*Math.random())
localos_session.ws.send(JSON.stringify({cmd:"auth",args:[],handler:"",data:{appName:$("meta[name=appx-app-name]").attr("content"),accessCode:a}})),$("#appx-status-msg").html("<span class='status-msg-error'>&nbsp;Local Connector Access Code: "+a+"&nbsp;</span>")}try{setTimeout(function(){if(appx_session.userhome=e[appx_session.globals.os.indexOf("Win")>-1?"USERPROFILE":"HOME"],appx_session.setProp("userHome",appx_session.userhome),$("#localos_access").prop("title",appx_session.language.tooltips.localVersion+appx_session.getProp("localConnectorVersionStr")),appx_session.getProp("localConnectorVersionNum")<appxServerClientVersionNum&&($("#localos_access").html("Local-").css({color:"#FF7","font-weight":"bold"}),appx_session.getProp("localConnectorVersionNum")>50402.009&&null==localos_session.isUpdating)){var a={cmd:"updatelocal",args:[],handler:"appx_updatelocal_handler",data:null}
appx_session.ws.send(JSON.stringify(a))}},1e3)}catch(o){console.log("localos_enviro_handler: can't set home - "+o),console.log(o.stack)}}function appxupdatelocalhandler(e){if(appxIsLocalReady()){var a={}
a.filename="localConnectorUpdate.zip",a.filedata=e,ms={cmd:"update",args:[a],handler:"localos_update_handler",data:null,authToken:localStorage.authToken},$("#localos_access").html("Updating").css({color:"#F77","font-weight":"bold"}),localos_session.isUpdating=!0,localos_session.ws.send(JSON.stringify(ms))}}function parseQueryString(){for(var e={},a=[],o=window.location.href.substring(window.location.href.indexOf("?")+1).split("&"),t=0;t<o.length;t++)a=o[t].split("="),e[decodeURI(a[0])]=decodeURI(a[1])
return e}function showLocalMissing(){var e="<h1>Local Desktop Access</h1><p>This application requires local access to your desktop to perform certain functions.  This is a one time activity that does not require any Administrator privileges.</p><p>To allow this access please perform the following steps:<ol><li>Click this link to download the local connector. (<a href='"+appxClientRoot+"/"+appx_session.localInstaller+"'>Download Local Connector</a>)</li><li>Run the downloaded file and follow the prompts.</li><li>Close this popup window to retry local desktop access.</li></p>",a=($("<div id='appx_prefs'>").css({background:"rgba(50, 50, 50, 0.7)",width:"100%",height:"100%","min-height":"220px","z-index":"10000000",display:"none",position:"absolute",top:"0px",left:"0px","font-family":"verdana","font-size":"11px"}).appendTo("body"),$("<div style='border: 10px solid #333;'>").css({width:"550px",height:"220px",background:"#fff"}).appendTo("#appx_prefs").position({my:"center",at:"center",of:window}).draggable()),o=$("<div>").css({margin:"0px 10px",width:"550px",height:"220px"}),t=$("<div>").css({background:"#333","text-align":"right",padding:"5px",color:"#F5F539","font-weight":"bold","padding-bottom":"10px"}).append($("<span>close(X)</span>").click(function(){$("#appx_prefs").hide(),$("#appx_prefs").remove(),localos_session=new LOCALOS}))
$(a).prepend($("<div>").append(t)),$(o).append($("<div>").append(e)),$(o).appendTo(a),$("#appx_prefs").show(),$(e).find("input").change(function(){appx_session.setProp($(this).attr("id"),$(this).val()),null!=appx_session.getRawProp($(this).attr("id"))?$(this).css({background:"#ff0"}):$(this).css({background:"#fff"})})}function LOCALOS(){function e(e){try{var a=new WebSocket("ws://127.0.0.1:3013/")
a.onmessage=function(a){debug&&(logactivity("svr message:  "),logactivity(a.data),appendMessage(a.data+"\n\n")),e.handler(a)},a.onopen=function(e){localos_access=!0,appx_session.localConnectorRunning=!0,$("#localos_access").removeClass().addClass("connected").html("<a href='"+appxClientRoot+"/"+appx_session.localInstaller+"'>Local+</a>"),appendMessage("* Connection to local server(localhost:3013)  open<br/>"),$("#functions").toggleClass("functions_on"),initialize_localos_session()},a.onclose=function(e){localos_access=!1,$("#localos_access").removeClass().addClass("disconnected").html("<a href='"+appxClientRoot+"/"+appx_session.localInstaller+"'>Local</a>"),"true"!=appxLocalRequired||localos_access||localos_session.isUpdating||navigator.userAgent.indexOf("Mobile")!==-1||(showLocalMissing(),appxLocalRequired=!1,appx_session.localConnectorRunning=!1),appendMessage("* Connection to local server(localhost:3013) closed<br/>"),$("#functions").toggleClass("functions_on")},a.onerror=function(e){appendMessage("* Local server(localhost:3013) Error<br/>")}}catch(o){alert(o),console.log(o.stack)}return a}function a(){function e(e){debug&&logactivity("main handler: "+e)
try{var a=JSON.parse(e.data)
switch(logactivity("data:  "+a.data),a.type){case"LOCALOS-RELOAD":setTimeout(function(){localos_session=new LOCALOS,localos_session.isUpdating=!1},500)
break
case"LOCALOS-AUTH":"allow"===a.data.authStatus?(localStorage.authToken=a.data.authToken,$("#appx-status-msg").html("")):$("#appx-status-msg").html("Access Denied")
break
case"LOCALOS-DND":appx_session.dndData=a.data,appxwidgetcallback(OPT_DROP)
break
case"LOCALOS-HTML":$("#appx-frame").append(a.data)
break
case"LOCALOS-STYLE":localos_style_handler(a.data)
break
case"LOCALOS-SCRIPT":inject_script(a.data)
break
case"LOCALOS-OPENFILE":localos_file_handler(a)
break
case"LOCALOS-OPENIMAGE":localos_image_handler(a.data)
break
case"LOCALOS-RUNCOMMAND":localos_cmd_handler(a.data)
break
case"LOCALOS-EXECOMMAND":localos_exec_handler(a.data)
break
case"LOCALOS-ENVIRONMENT":localos_enviro_handler(a.data)
break
case"LOCALOS-SETCLIPBOARD":localos_setclipboard_handler(a.data)
break
case"LOCALOS-GETCLIPBOARD":localos_getclipboard_handler(a.data)
break
case"LOCALOS-FILE-DIALOG":localos_file_dialog_handler(a.data)
break
case"LOCALOS-ERROR":localos_error_handler(a)
break
case"LOCALOS-CREATEFILE":localos_create_file_handler(a.data)
break
case"LOCALOS-APPENDFILE":localos_append_file_handler(a.data)
break
default:logactivity("No handler for LOCAL OS Data Message:  "+e.data)}}catch(o){logactivity(o),console.log("LOCAL Handler: "+o),console.log(o.stack)}}this.handler=e}this.message=new a,this.ws=e(this.message),this.current_msg={header:[]},this.isUpdating=null}function localos_file_dialog_handler(e){var a=$(".awaiting_filepath")
$(a).removeClass("awaiting_filepath"),e&&e.length>0&&e[0].length>0&&($(a).val(e),$(a).addClass("dirty"))}function localos_setclipboard_handler(e){logactivity("localos_setclipboard_handler() called..."),console.log("clipboard data set in localos:  "+e)}function localos_getclipboard_handler(e){logactivity("localos_setclipboard_handler() called..."),console.log("clipboard data got in localos:  "+e)
var a=e,o={cmd:"appxclipboard",args:[a],handler:"appxsendfilehandler",data:null}
appx_session.ws.send(JSON.stringify(o))}function localos_exec_handler(e){logactivity("localos_exec_handler() called..."),console.log("an exec handler was called:  "),console.dir(e)}function localos_error_handler(e){if(logactivity("localos_error_handler() called..."),console.log("an error occurred on localos connector:  "),console.dir(e),"openfile"===e.cmd){var a={cmd:"appxmessage",args:[3,0],handler:"APPXRECEIVEFILE",data:null}
appx_session.ws.send(JSON.stringify(a))}}function localos_file_handler(e){appx_session.ws.send(JSON.stringify(e)),logactivity("localos_file_handler() called...")}function APPX(e,a,o,t,n,s,r){function p(e,a,o,t,n,s){function r(){var e={cmd:"ping",args:[0,0],handler:"",data:null}
i.send(JSON.stringify(e)),c=setTimeout(r,3e4)}var i
null!=a&&null!=o?"ssl"==t?(ws_url="wss://"+a+":"+o+n,$("#appxFooterSSL").show(),$("#appxLoginSSL").show()):ws_url="ws://"+a+":"+o+n:ws_url="ws://localhost:3014/",i=new WebSocket(ws_url),i.send=function(e){var a=e
return appx_session.crypto&&(a=CryptoJS.AES.encrypt(e,"APPX",{format:JsonFormatter})),WebSocket.prototype.send.call(this,a)},i.onmessage=function(a){var o=a.data
appx_session.crypto&&(o=CryptoJS.AES.decrypt(a.data,"APPX",{format:JsonFormatter}).toString(CryptoJS.enc.Utf8)),e.handler(a,o)}
var c
return i.onopen=function(e){APPX.access=!0,appx_access=!0,r(),$("#appx_access").html("Remote+").css({color:"lime","font-weight":"bold"}),$("#functions").toggleClass("functions_on"),initialize_appx_session(s)},i.onclose=function(e){if(clearTimeout(c),APPX.access=!1,appx_access=!1,$("#appx_access").html("Remote").css({color:"#F77","font-weight":"bold"}),$("#functions").toggleClass("functions_on"),appx_session.connected){var a=$("<span>").html("Lost connection to server").addClass("status-msg").addClass("status-msg-error")
$("#appx-status-msg").html(a)}},i.onerror=function(r){console.log(r),l.connectRetryCount>0&&(l.connectRetryCount--,l.ws=p(e,a,o,t,n,s))},i}function i(){function e(e,a){debug&&logactivity("main handler: "+e)
try{var o=JSON.parse(a)
switch(o.serverConnectorVersionStr&&(appx_session.serverConnectorVersionStr=o.serverConnectorVersionStr,appx_session.serverConnectorVersionNum=o.serverConnectorVersionNum),o.mongoStatus&&("Error"!==o.mongoStatus||appx_session.mongoErrorDisplayed||(console.log(mongoConnectError),alert(appx_session.language.alerts.mongoConnectError),appx_session.mongoErrorDisplayed=!0)),appx_session.serverInterrupt=!1,o.type){case"HTML":$("#appx-frame").append(o.data)
break
case"STYLE":inject_style(o.data)
break
case"UPDATE":appxupdatelocalhandler(o.data)
break
case"SCRIPT":inject_script(o.data)
break
case"APPXLOGIN":appxloginhandler(o),appx_session.loginTimeout=!1
break
case"APPXRECONNECT":appxreconnecthandler(o)
break
case"APPXINIT":appxinithandler(o)
break
case"APPXFEATURES":appxfeatureshandler(o)
break
case"APPXEXTENDEDFEATURES":appxextendedfeatureshandler(o)
break
case"APPXPID":appxpidhandler(o)
break
case"APPXATTACH":appxattachhandler(o),$(document).on("keydown",function(e){sendkey(e)}),$(document).on("keyup",function(e){sendkey(e)})
break
case"APPXKEYMAP":appxkeymaphandler(o)
break
case"APPXITEMS":appxitemshandler(o)
break
case"APPXMSGS":appxmsgshandler(o)
break
case"APPXWIDGETS":appxwidgetshandler(o)
break
case"APPXSHOW":appxshowhandler(o)
break
case"APPXSCREEN":appx_session.blur=!1,appxscreenhandler(o)
break
case"APPXATTRIBUTES":appxattributeshandler(o)
break
case"APPXEXTRAATTRIBUTES":appxextraattributeshandler(o)
break
case"APPXPING":appxpinghandler(o)
break
case"APPXTOKEN":appxtokenhandler(o)
break
case"APPXRESOURCE":AppxResource.handler(o)
break
case"APPXSETFIELD":appxsetfieldhandler(o)
break
case"APPXLOADURL":appxloadurlhandler(o)
break
case"APPXRECEIVEFILE":appxreceivefilehandler(o)
break
case"APPXFILEUPLOADPROGRESS":appxfileuploadprogresshandler(o)
break
case"APPXSENDFILE":appxsendfilehandler(o)
break
case"APPXMENU":appxmenuhandler(o)
break
case"APPXCREATEOBJECT":appxobjectcreatehandler(o)
break
case"APPXINVOKEOBJECT":appxobjectinvokehandler(o)
break
case"APPXDESTROYOBJECT":appxobjectdestroyhandler(o)
break
case"APPXFINISH":appxfinishhandler(o)
break
case"APPXCNSTS":appxconstantshandler(o)
break
case"APPXGETCLIPBOARD":appxgetclipboardhandler(o)
break
case"APPXSETCLIPBOARD":appxsetclipboardhandler(o)
break
case"APPXTABLEDATA":appxtabledatahandler(o)
break
case"APPXQUERYTABLEDATA":appxupdatetabledatahandler(o)
break
case"APPXENCODINGERROR":appxEncodingError(o.data[1])
case"APPXPROCSTACK":appxProcessStack(o.data)
default:logactivity("No handler for APPX Data Message:  "+a)}}catch(t){logactivity(t),console.log("REMOTE Handler: "+t),console.log(t.stack)}}this.handler=e}var l=this
switch(this.connectRetryCount=2,this.message=new i,this.ws=p(this.message,e,a,n,t,r),this.appxDataCacheUrl=appxProtocol+"://"+appxConnectorHost+":"+appxConnectorMongoPort+appxConnectorPathHttp+"/getGridData",this.appxCacheUrl=appxProtocol+"://"+appxConnectorHost+":"+appxConnectorMongoPort+appxConnectorPathHttp,this.appxResourceUrl=appxProtocol+"://"+appxConnectorHost+":"+appxConnectorMongoPort+appxConnectorPathHttp+"/getResource/",this.current_msg={header:[]},this.uploadURL=null,this.userPrefsURL=null,this.init_optimization_flag=null,this.override=!1,this.blur=!1,this.current_show=null,this.clientIds={},this.editorConfigs={},this.widgets=[],this.appxTableList={},this.currenttabledata=[],this.items=[],this.rowtext=[],this.lineSeparator,this.basefontsize=s,this.rowHeightPx=21,this.colWidthPx=8,this.processhelp=!1,this.processhelpoption=null,this.runOnUnlock=[],this.scan=!1,this.screenrows=31,this.screencols=110,this.container_top=80,this.language={},this.image_cache={keys:[],length:0},this.token_cache={keys:[],length:0},this.token_groups={},this.showErrorDialog=null,this.pid=0,this.currsendfile={filename:"",filedata:[]},this.datacachepath="",this.loginTimeout=!0,this.serverConnectorVersionStr,this.serverConnectorVersionNum,this.localConnectorRunning=!1,this.localInstaller=null,this.mongoErrorDisplayed=!1,this.server=e,this.port=a,this.mongoPort=o,this.user=null,this.password=null,this.path=t,this.protocol=n,this.crypto="aes"==n,this.currentmenu=null,this.showoptnums=!1,this.createWidgetTag={},this.optionOverride={},this.globals={},this.gridcache={},this.gridpropscache={},this.dndData=[],this.connected=!1,this.interactT=null,this.interactTblur=null,this.topboxid=null,this.objFocus=null,this.objEventFired=!1,this.objItems=null,this.signaturePad,this.signaturePadID,this.signaturePadFail=!0,this.serverInterrupt=!1,this.activeDatepicker=null,this.locked=!1,this.keyLeft=null,this.msgs=[],this.dirtySinceSave=!1,this.tablist=null,this.lastOption,this.keyPauseLastPosition,this.rawEncoding,this.buildingEm=!1,this.config={debug:{tableLogging:!0}},this.rowCallback=!1,this.pendingResources={length:0},this.pendingTables=0,this.tableOptions,this.tableLoaded=!0,this.tablePreferences={},this.tableDefaults={},this.fileRecommendedUploadSize=parseInt($("meta[name=appx-recommended-upload-size]").attr("content")),this.fileCount=0,this.mongoFileUpload=[],this.mongoURL="",this.dropEvent=null,this.filesUploadArray=[],this.centerHorizontalOffset=76,this.centerVerticalOffset=0,this.valueTimer=null,this.valueTimerStart=function(e,a){if(appx_session.valueTimerStop(),e&&e!=OPT_NULL){var o=parseInt(appx_session.getProp("valueChangedTimer"))
o>0&&(logca("setting timeout"),appx_session.valueTimer=setTimeout(function(e){appx_session.valueTimer?(appx_session.valueTimerStop(),appx_session.keyPauseLastPosition=getCursorPosition(a),logca("keyPause: "+e),appxIsLocked()?logca("(locked"):appxwidgetcallback(e)):logca("keyPause was cancelled")},o,e))}},this.valueTimerStop=function(){appx_session.valueTimer&&(clearTimeout(appx_session.valueTimer),appx_session.valueTimer=null,logca("valueTimer stopped"))},this.globals.os=window.navigator.platform,this.globals.os){case"Win32":case"Win64":this.localInstaller="localConnector_win.exe",this.lineSeparator="\r \n"
break
case"MacIntel":this.localInstaller="localConnector_osx.dmg",this.lineSeparator="\n"
break
case"Linux x86_64":this.localInstaller="localConnector_linux64.sh",this.lineSeparator="\n"
break
case"Linux i686":this.localInstaller="localConnector_linux32.sh",this.lineSeparator="\n"
break
default:this.localInstaller="System Unknown",this.lineSeparator="\r \n"}var c=3621123835
mask0=(4278190080&c)>>24,mask1=(16711680&c)>>16,mask2=(65280&c)>>8,mask3=255&c,this.feature_mask=[parseInt(mask0),parseInt(mask1),parseInt(mask2),parseInt(mask3)]
var d=251
exmask0=(4278190080&d)>>24,exmask1=(16711680&d)>>16,exmask2=(65280&d)>>8,exmask3=255&d,this.extended_feature_mask=[parseInt(exmask0),parseInt(exmask1),parseInt(exmask2),parseInt(exmask3)],$("<div id='appx_main_container_wrapper'>").addClass("appx_main_container_wrapper").append($("#appx_main_container")).appendTo("#main"),this.loginTimer=function(){setTimeout(function(){appx_session.loginTimeout&&(alert(appx_session.language.alerts.serverConnectError),location.reload())},1e4)}}function fetchQueryTableRowData(e,a,o,t){var n={cmd:"appxquerytabledata",args:[e,a],handler:"appxquerytabledata",data:null}
appx_session.ws.send(JSON.stringify(n))}function appxupdatetabledatahandler(e){updateGridMongo(e.data.rows,e.data.elid)}function appxProcessStack(e){for(var a in appx_session.gridpropscache){var o=!1
for(var t in e)a.indexOf(t)>-1&&(o=!0)
o||delete appx_session.gridpropscache[a]}}function fetchInitialTableRowData(e,a,o,t){var n={cmd:"appxtabledata",args:[e,a,o,t],handler:"appxtabledata",data:null}
appx_session.ws.send(JSON.stringify(n))}function appxtabledatahandler(e){var a=appx_session.currenttabledata[e.data.elid]
createGridMongo(a,e.data.rows,e.data.elid)}function urlParam(e){var a=urlParamEx(window.location.href,e)
if(!a&&urlParamEx(window.location.href,"payload")){var o=4-urlParamEx(window.location.href,"payload")%4,t=""
o&&(t="===".substring(0,o)),a=urlParamEx(atob(urlParamEx(window.location.href,"payload").split("").reverse().join("").concat(t)),e)}return a}function urlParamEx(e,a){var o=new RegExp("[?&]"+a+"=([^&#]*)").exec(e)
return o?decodeURIComponent(o[1])||null:null}function checkLogin(){var e=parseQueryString()
"true"===$("meta[name=appx-allow-noLogin]").attr("content")&&(e.hasOwnProperty("requireLogin")&&$($("meta[name=appx-use-noLogin]")[0]).attr("content","false"===e.requireLogin),"true"!==$("meta[name=appx-use-noLogin]").attr("content")&&"false"!==e.requireLogin||(e.hasOwnProperty("user")&&$($("meta[name=appx-auto-user]")[0]).attr("content",e.user),e.hasOwnProperty("password")&&$($("meta[name=appx-auto-pswd]")[0]).attr("content",e.password),e.hasOwnProperty("host")&&$($("meta[name=appx-auto-host]")[0]).attr("content",e.host),e.hasOwnProperty("port")&&$($("meta[name=appx-auto-port]")[0]).attr("content",e.port),e.hasOwnProperty("specific")&&$($("meta[name=appx-use-specific]")[0]).attr("content",e.specific),e.hasOwnProperty("application")&&$($("meta[name=appx-application]")[0]).attr("content",e.application),e.hasOwnProperty("database")&&$($("meta[name=appx-database]")[0]).attr("content",e.database),e.hasOwnProperty("procType")&&$($("meta[name=appx-ProcType]")[0]).attr("content",e.procType),e.hasOwnProperty("process")&&$($("meta[name=appx-process]")[0]).attr("content",e.process),startSpecificProcess(!1)))}function adjustZoom(e){var a={transform:"scale("+e+")","-webkit-transform":"scale("+e+")","-moz-transform":"scale("+e+")","-moz-transform-origin":"left top"}
$("#appx_main_container_wrapper").css(a)}function zoomMax(){if(appx_session){null===appxOffsetTop&&getOriginalTop()
var e=$("#appx_main_container_wrapper").width()/(appx_session.colWidthPx*appx_session.screencols+18),a=appxOffsetTop/(appx_session.rowHeightPx*appx_session.screenrows)
appxZoom=Math.min(e,a),adjustZoom(appxZoom)}}function zoomAuto(){if(appxZoomAuto&&appx_session){null===appxOffsetTop&&getOriginalTop()
var e=$("#appx_main_container_wrapper").width()/(appx_session.colWidthPx*appx_session.screencols+18),a=appxOffsetTop/(appx_session.rowHeightPx*appx_session.screenrows)
appxZoom=Math.min(e,a),adjustZoom(appxZoom)}}function getVisibleOld(e){var a=$("#"+e),o=$(this).scrollTop(),t=o+$(this).height(),n=a.offset().top,s=n+a.outerHeight(),r=n<o?o:n,p=s>t?t:s
return p-r}function getVisible(e){var a=$("#"+e),o=a.offset().top,t=o+$("#status_bar").height(),n=$(window).height()
return n-t-o}function getOriginalTop(){appxOffsetTop=getVisible("appx_main_container_wrapper")}function closeSession(){"undefined"!==wss&&null!==wss&&wss.close(),ws&&ws.close(),appx_session.wss&&appx_session.wss.close(),appx_session.ws&&appx_session.ws.close()}function launchIntoFullscreen(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullscreen?e.mozRequestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullscreen?document.mozCancelFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}function boxResize(){var e=$("#appx_main_container").width(),a=appx_session.centerHorizontalOffset
$("#appx_main_container").children().each(function(){var o=$(this).attr("id"),t=(e-$(this).width())/2
if(t<0&&(t=0),void 0!==o){var n=parseInt(o.substring(o.lastIndexOf("_")+1))
if((0===n||t<=appx_session.centerHorizontalOffset)&&appx_session.getProp("centerAppx")){var s=appx_session.centerHorizontalOffset
appx_session.centerHorizontalOffset=t
for(var r=0;r<n;r++){var p=$("#box_"+r)
if(p.length){var i=p.position().left-s
p.css({left:i+appx_session.centerHorizontalOffset+"px"})}}}var l=$(this).position().left,c=l-a+appx_session.centerHorizontalOffset
c<0&&(c=0)
if($(this).css({left:c+"px"}),1===n){var d=$("#box_0"),u=$(this)
d.children().length<=1&&d.position().top===u.position().top&&d.width===u.width&&d.height===u.height&&d.css({left:c+"px"})}}})}var appxPublicClientVersionStr="0.0.0",appxPublicClientVersionNum=6e4,testca=0,cMsgCount=0,JsonFormatter={stringify:function(e){var a={ct:e.ciphertext.toString(CryptoJS.enc.Base64)}
return e.iv&&(a.iv=e.iv.toString()),e.salt&&(a.s=e.salt.toString()),JSON.stringify(a)},parse:function(e){var a=JSON.parse(e),o=CryptoJS.lib.CipherParams.create({ciphertext:CryptoJS.enc.Base64.parse(a.ct)})
return a.iv&&(o.iv=CryptoJS.enc.Hex.parse(a.iv)),a.s&&(o.salt=CryptoJS.enc.Hex.parse(a.s)),o}},appxLoginFormHost=$("meta[name=appx-login-host]").attr("content"),appxLoginFormPort=$("meta[name=appx-login-port]").attr("content"),appxLoginFormUser=$("meta[name=appx-login-user]").attr("content"),appxLoginFormPswd=$("meta[name=appx-login-pswd]").attr("content"),appxLoginFormRows=$("meta[name=appx-login-rows]").attr("content"),appxLoginFormCols=$("meta[name=appx-login-cols]").attr("content"),appxLoginFormHostHide="true"==$("meta[name=appx-login-host]").attr("hide"),appxLoginFormPortHide="true"==$("meta[name=appx-login-port]").attr("hide"),appxLoginFormUserHide="true"==$("meta[name=appx-login-user]").attr("hide"),appxLoginFormPswdHide="true"==$("meta[name=appx-login-pswd]").attr("hide"),appxLoginFormRowsHide="true"==$("meta[name=appx-login-rows]").attr("hide"),appxLoginFormColsHide="true"==$("meta[name=appx-login-cols]").attr("hide"),appxLoginFormMinified="min"==$("meta[name=appx-login-cols]").attr("content"),appxConnectorHost=$("meta[name=appx-proxy-host]").attr("content"),appxConnectorPort=$("meta[name=appx-proxy-port]").attr("content"),appxConnectorMongoPort=$("meta[name=appx-mongo-port]").attr("content"),appxConnectorPath=$("meta[name=appx-proxy-path]").attr("content"),appxConnectorPathHttp,appxProtocol
void 0===appxConnectorMongoPort&&(appxConnectorMongoPort=3015),appxConnectorPath.indexOf("wss")!=-1?(appxProtocol="https",appxConnectorPathHttp=appxConnectorPath.substring(0,appxConnectorPath.length-4)+appxProtocol):(appxProtocol="http",appxConnectorPathHttp=appxConnectorPath.substring(0,appxConnectorPath.length-3)+appxProtocol)
var appxClientRoot=$("meta[name=appx-client-root]").attr("content"),appxUseSoftkeys="true"==$("meta[name=appx-use-softkeys]").attr("content"),appxLoginAutoConnect="true"==$("meta[name=appx-auto-connect]").attr("content"),appxLocalRequired=$("meta[name=appx-local-required]").attr("content"),appxStaticTools=$("meta[name=appx-static-tools]").attr("content"),appxFillWindow=$("meta[name=appx-fill-window]").attr("content"),appxCloseOnExit=$("meta[name=appx-close-on-exit]").attr("content"),appxNewSession=!1,appxEncryption=$("meta[name=appx-encryption]").attr("content")
urlParam("acon")&&(appxLoginAutoConnect="true"==urlParam("acon"),appxLoginAutoConnect&&(appxCloseOnExit="back")),urlParam("localRequired")&&(appxLocalRequired="true"==urlParam("localRequired")),urlParam("user")&&(appxLoginFormUser=urlParam("user",appxLoginFormUser)),urlParam("port")&&(appxLoginFormPort=urlParam("port",appxLoginFormPort)),urlParam("host")&&(appxLoginFormHost=urlParam("host",appxLoginFormHost)),urlParam("rows")&&(appxLoginFormRows=urlParam("rows",appxLoginFormRows)),urlParam("cols")&&(appxLoginFormCols=urlParam("cols",appxLoginFormCols)),urlParam("pswd")&&(appxLoginFormPswd=urlParam("pswd")),appxLoginFormUser.length>0&&$("#appx_username").val(appxLoginFormUser),appxLoginFormPswd.length>0&&$("#appx_password").val(appxLoginFormPswd),appxLoginFormHost.length>0&&$("#appx_server").val(appxLoginFormHost),appxLoginFormPort.length>0&&$("#appx_port").val(appxLoginFormPort),appxLoginFormRows.length>0&&$("#appx_rows").val(appxLoginFormRows),appxLoginFormCols.length>0&&$("#appx_cols").val(appxLoginFormCols)
var focusElem=null
appxLoginFormColsHide?$("#appxLoginFormCols").attr("style","display: none;"):focusElem=$("#appx_cols"),appxLoginFormRowsHide?$("#appxLoginFormRows").attr("style","display: none;"):focusElem=$("#appx_rows"),appxLoginFormPortHide?$("#appxLoginFormPort").attr("style","display: none;"):focusElem=$("#appx_port"),appxLoginFormHostHide?$("#appxLoginFormHost").attr("style","display: none;"):focusElem=$("#appx_host"),appxLoginFormPswdHide?$("#appxLoginFormPswd").attr("style","display: none;"):focusElem=$("#appx_password"),appxLoginFormUserHide?$("#appxLoginFormUser").attr("style","display: none;"):focusElem=$("#appx_username"),focusElem&&focusElem.attr("autofocus","true")
var appxZoom=1,appxOffsetTop=null
$("#appx_zoom_in").click(function(){appxZoomAuto=!1,$("#appx_zoom_auto").css({color:"initial"}),appxZoom+=.1,adjustZoom(appxZoom),boxResize()}),$("#appx_zoom_out").click(function(){appxZoomAuto=!1,$("#appx_zoom_auto").css({color:"initial"}),appxZoom-=.1,adjustZoom(appxZoom),boxResize()}),$("#appx_zoom_dflt").click(function(){appxZoomAuto=!1,$("#appx_zoom_auto").css({color:"initial"}),appxZoom=1,adjustZoom(appxZoom),boxResize()}),$("#appx_zoom_max").click(function(){appxZoomAuto=!1,$("#appx_zoom_auto").css({color:"initial"}),zoomMax(),boxResize()}),$("#appx_zoom_full").click(function(){appxFullscreen?(appxFullscreen=!1,exitFullscreen()):(appxFullscreen=!0,launchIntoFullscreen(document.documentElement))}),$("#appx_zoom_auto").click(function(){appxZoomAuto?(appxZoomAuto=!1,appxZoom=appxZoomSave,$("#appx_zoom_auto").css({color:"initial"})):(appxZoomAuto=!0,appxZoomSave=appxZoom,$("#appx_zoom_auto").css({color:"red"})),zoomAuto(),adjustZoom(appxZoom),boxResize()})
var appxFullscreen=!1,appxZoomAuto=!1,appxZoomSave=1
$(window).on("scroll",zoomAuto),$(window).on("resize",function(){zoomAuto(),boxResize()})
var debug=!1,loggedin=!1,appxclientversion=[3,4],appxserverversion=null,client_init_sent=!1,appx_session,localos_session,localos_access=!1,appx_access=!1,xTriggered=0,optionTriggered=0,digits=[],basefontsize=14
$(document).ready(function(){debug?$("#log").show():$("#log").hide(),$(document.body).append($("<span>").attr("id","fontcheck").css({display:"none","font-family":"courier","font-size":"14px",padding:"0px",margin:"0px","box-sizing":"border-box"}).text("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX")),$("#fontcheck").width()>800&&(basefontsize=14*(1-($("#fontcheck").width()-800)/$("#fontcheck").width())),$("#fontcheck").remove()
var e="MozWebSocket"in window?"MozWebSocket":"WebSocket"in window?"WebSocket":null
if(null!=e)if(appendMessage("WebSockets --  are fully supported in this browser."),localStorage.newsession){appxNewSession=!0
var a=JSON.parse(localStorage.newsession)
delete localStorage.newsession,appx_session=new APPX(appxConnectorHost,appxConnectorPort,appxConnectorMongoPort,appxConnectorPath,appxEncryption,basefontsize,appxLoginFormMinified),appx_session.startupinfo=a,setTimeout(function(){sendappxnewsessionlogin(a.remoteHost,a.remotePort,a.remoteUser,a.remotePassword,a)},1500)}else appx_session=new APPX(appxConnectorHost,appxConnectorPort,appxConnectorMongoPort,appxConnectorPath,appxEncryption,basefontsize,appxLoginFormMinified)
else appendMessage(webSocketError)
$("#localos_access").removeClass().html("<a href='"+appxClientRoot+"/"+appx_session.localInstaller+"'>Local</a>"),loadLanguage(),void 0==appxClientRoot&&alert(appx_session.language.alerts.rootError)}),$(function(){window.onbeforeunload=function(e){if(appx_session.connected)return e.returnValue="This will end your Appx session!","This will end your Appx session!"},window.onunload=function(e){appx_session.connected&&appxwidgetcallback(356),closeSession()},console.log("%cYou should only be here under the direction of APPX Technical Support. Please contact your System Administrator if this is not the case.","background-color: black; color: yellow; font-size: large")})
