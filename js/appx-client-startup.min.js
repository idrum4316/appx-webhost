/*********************************************************************
 **
 **   public/js/appx-client-startup.js - Client entry point code
 **
 **   This module is the main entry point into the client.  It also
 **   has some initial startup helper code.
 **
 *********************************************************************/
function urlParam(o){var e=urlParamEx(window.location.href,o)
if(!e&&urlParamEx(window.location.href,"payload")){var a=4-urlParamEx(window.location.href,"payload")%4,t=""
a&&(t="===".substring(0,a)),e=urlParamEx(atob(urlParamEx(window.location.href,"payload").split("").reverse().join("").concat(t)),o)}return e}function urlParamEx(o,e){var a=new RegExp("[?&]"+e+"=([^&#]*)").exec(o)
return a?decodeURIComponent(a[1])||null:null}function checkLogin(){var o=parseQueryString()
"true"===$("meta[name=appx-allow-noLogin]").attr("content")&&(o.hasOwnProperty("requireLogin")&&$($("meta[name=appx-use-noLogin]")[0]).attr("content","false"===o.requireLogin),"true"!==$("meta[name=appx-use-noLogin]").attr("content")&&"false"!==o.requireLogin||(o.hasOwnProperty("user")&&$($("meta[name=appx-auto-user]")[0]).attr("content",o.user),o.hasOwnProperty("password")&&$($("meta[name=appx-auto-pswd]")[0]).attr("content",o.password),o.hasOwnProperty("host")&&$($("meta[name=appx-auto-host]")[0]).attr("content",o.host),o.hasOwnProperty("port")&&$($("meta[name=appx-auto-port]")[0]).attr("content",o.port),o.hasOwnProperty("specific")&&$($("meta[name=appx-use-specific]")[0]).attr("content",o.specific),o.hasOwnProperty("application")&&$($("meta[name=appx-application]")[0]).attr("content",o.application),o.hasOwnProperty("database")&&$($("meta[name=appx-database]")[0]).attr("content",o.database),o.hasOwnProperty("procType")&&$($("meta[name=appx-ProcType]")[0]).attr("content",o.procType),o.hasOwnProperty("process")&&$($("meta[name=appx-process]")[0]).attr("content",o.process),startSpecificProcess(!1)))}function adjustZoom(o){var e={transform:"scale("+o+")","-webkit-transform":"scale("+o+")","-moz-transform":"scale("+o+")","-moz-transform-origin":"left top"}
$("#appx_main_container_wrapper").css(e)}function zoomMax(){if(appx_session){null===appxOffsetTop&&getOriginalTop()
var o=$("#appx_main_container_wrapper").width()/(appx_session.colWidthPx*appx_session.screencols+18),e=appxOffsetTop/(appx_session.rowHeightPx*appx_session.screenrows)
appxZoom=Math.min(o,e),adjustZoom(appxZoom)}}function zoomAuto(){if(appxZoomAuto&&appx_session){null===appxOffsetTop&&getOriginalTop()
var o=$("#appx_main_container_wrapper").width()/(appx_session.colWidthPx*appx_session.screencols+18),e=appxOffsetTop/(appx_session.rowHeightPx*appx_session.screenrows)
appxZoom=Math.min(o,e),adjustZoom(appxZoom)}}function getVisibleOld(o){var e=$("#"+o),a=$(this).scrollTop(),t=a+$(this).height(),p=e.offset().top,n=p+e.outerHeight(),r=p<a?a:p,s=n>t?t:n
return s-r}function getVisible(o){var e=$("#"+o),a=e.offset().top,t=a+$("#status_bar").height(),p=$(window).height()
return p-t-a}function getOriginalTop(){appxOffsetTop=getVisible("appx_main_container_wrapper")}function closeSession(){"undefined"!==wss&&null!==wss&&wss.close(),ws&&ws.close(),appx_session.wss&&appx_session.wss.close(),appx_session.ws&&appx_session.ws.close()}function launchIntoFullscreen(o){o.requestFullscreen?o.requestFullscreen():o.mozRequestFullscreen?o.mozRequestFullscreen():o.webkitRequestFullscreen?o.webkitRequestFullscreen():o.msRequestFullscreen&&o.msRequestFullscreen()}function exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullscreen?document.mozCancelFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}function boxResize(){var o=$("#appx_main_container").width(),e=appx_session.centerHorizontalOffset
$("#appx_main_container").children().each(function(){var a=$(this).attr("id"),t=(o-$(this).width())/2
if(t<0&&(t=0),void 0!==a){var p=parseInt(a.substring(a.lastIndexOf("_")+1))
if((0===p||t<=appx_session.centerHorizontalOffset)&&appx_session.getProp("centerAppx")){var n=appx_session.centerHorizontalOffset
appx_session.centerHorizontalOffset=t
for(var r=0;r<p;r++){var s=$("#box_"+r)
if(s.length){var i=s.position().left-n
s.css({left:i+appx_session.centerHorizontalOffset+"px"})}}}var l=$(this).position().left,c=l-e+appx_session.centerHorizontalOffset
c<0&&(c=0)
if($(this).css({left:c+"px"}),1===p){var x=$("#box_0"),m=$(this)
x.children().length<=1&&x.position().top===m.position().top&&x.width===m.width&&x.height===m.height&&x.css({left:c+"px"})}}})}var appxLoginFormHost=$("meta[name=appx-login-host]").attr("content"),appxLoginFormPort=$("meta[name=appx-login-port]").attr("content"),appxLoginFormUser=$("meta[name=appx-login-user]").attr("content"),appxLoginFormPswd=$("meta[name=appx-login-pswd]").attr("content"),appxLoginFormRows=$("meta[name=appx-login-rows]").attr("content"),appxLoginFormCols=$("meta[name=appx-login-cols]").attr("content"),appxLoginFormHostHide="true"==$("meta[name=appx-login-host]").attr("hide"),appxLoginFormPortHide="true"==$("meta[name=appx-login-port]").attr("hide"),appxLoginFormUserHide="true"==$("meta[name=appx-login-user]").attr("hide"),appxLoginFormPswdHide="true"==$("meta[name=appx-login-pswd]").attr("hide"),appxLoginFormRowsHide="true"==$("meta[name=appx-login-rows]").attr("hide"),appxLoginFormColsHide="true"==$("meta[name=appx-login-cols]").attr("hide"),appxLoginFormMinified="min"==$("meta[name=appx-login-cols]").attr("content"),appxConnectorHost=$("meta[name=appx-proxy-host]").attr("content"),appxConnectorPort=$("meta[name=appx-proxy-port]").attr("content"),appxConnectorMongoPort=$("meta[name=appx-mongo-port]").attr("content"),appxConnectorPath=$("meta[name=appx-proxy-path]").attr("content"),appxConnectorPathHttp,appxProtocol
void 0===appxConnectorMongoPort&&(appxConnectorMongoPort=3015),appxConnectorPath.indexOf("wss")!=-1?(appxProtocol="https",appxConnectorPathHttp=appxConnectorPath.substring(0,appxConnectorPath.length-4)+appxProtocol):(appxProtocol="http",appxConnectorPathHttp=appxConnectorPath.substring(0,appxConnectorPath.length-3)+appxProtocol)
var appxClientRoot=$("meta[name=appx-client-root]").attr("content"),appxUseSoftkeys="true"==$("meta[name=appx-use-softkeys]").attr("content"),appxLoginAutoConnect="true"==$("meta[name=appx-auto-connect]").attr("content"),appxLocalRequired=$("meta[name=appx-local-required]").attr("content"),appxStaticTools=$("meta[name=appx-static-tools]").attr("content"),appxFillWindow=$("meta[name=appx-fill-window]").attr("content"),appxCloseOnExit=$("meta[name=appx-close-on-exit]").attr("content"),appxNewSession=!1,appxEncryption=$("meta[name=appx-encryption]").attr("content")
urlParam("acon")&&(appxLoginAutoConnect="true"==urlParam("acon"),appxLoginAutoConnect&&(appxCloseOnExit="back")),urlParam("localRequired")&&(appxLocalRequired="true"==urlParam("localRequired")),urlParam("user")&&(appxLoginFormUser=urlParam("user",appxLoginFormUser)),urlParam("port")&&(appxLoginFormPort=urlParam("port",appxLoginFormPort)),urlParam("host")&&(appxLoginFormHost=urlParam("host",appxLoginFormHost)),urlParam("rows")&&(appxLoginFormRows=urlParam("rows",appxLoginFormRows)),urlParam("cols")&&(appxLoginFormCols=urlParam("cols",appxLoginFormCols)),urlParam("pswd")&&(appxLoginFormPswd=urlParam("pswd")),appxLoginFormUser.length>0&&$("#appx_username").val(appxLoginFormUser),appxLoginFormPswd.length>0&&$("#appx_password").val(appxLoginFormPswd),appxLoginFormHost.length>0&&$("#appx_server").val(appxLoginFormHost),appxLoginFormPort.length>0&&$("#appx_port").val(appxLoginFormPort),appxLoginFormRows.length>0&&$("#appx_rows").val(appxLoginFormRows),appxLoginFormCols.length>0&&$("#appx_cols").val(appxLoginFormCols)
var focusElem=null
appxLoginFormColsHide?$("#appxLoginFormCols").attr("style","display: none;"):focusElem=$("#appx_cols"),appxLoginFormRowsHide?$("#appxLoginFormRows").attr("style","display: none;"):focusElem=$("#appx_rows"),appxLoginFormPortHide?$("#appxLoginFormPort").attr("style","display: none;"):focusElem=$("#appx_port"),appxLoginFormHostHide?$("#appxLoginFormHost").attr("style","display: none;"):focusElem=$("#appx_host"),appxLoginFormPswdHide?$("#appxLoginFormPswd").attr("style","display: none;"):focusElem=$("#appx_password"),appxLoginFormUserHide?$("#appxLoginFormUser").attr("style","display: none;"):focusElem=$("#appx_username"),focusElem&&focusElem.attr("autofocus","true")
var appxZoom=1,appxOffsetTop=null
$("#appx_zoom_in").click(function(){appxZoomAuto=!1,$("#appx_zoom_auto").css({color:"initial"}),appxZoom+=.1,adjustZoom(appxZoom),boxResize()}),$("#appx_zoom_out").click(function(){appxZoomAuto=!1,$("#appx_zoom_auto").css({color:"initial"}),appxZoom-=.1,adjustZoom(appxZoom),boxResize()}),$("#appx_zoom_dflt").click(function(){appxZoomAuto=!1,$("#appx_zoom_auto").css({color:"initial"}),appxZoom=1,adjustZoom(appxZoom),boxResize()}),$("#appx_zoom_max").click(function(){appxZoomAuto=!1,$("#appx_zoom_auto").css({color:"initial"}),zoomMax(),boxResize()}),$("#appx_zoom_full").click(function(){appxFullscreen?(appxFullscreen=!1,exitFullscreen()):(appxFullscreen=!0,launchIntoFullscreen(document.documentElement))}),$("#appx_zoom_auto").click(function(){appxZoomAuto?(appxZoomAuto=!1,appxZoom=appxZoomSave,$("#appx_zoom_auto").css({color:"initial"})):(appxZoomAuto=!0,appxZoomSave=appxZoom,$("#appx_zoom_auto").css({color:"red"})),zoomAuto(),adjustZoom(appxZoom),boxResize()})
var appxFullscreen=!1,appxZoomAuto=!1,appxZoomSave=1
$(window).on("scroll",zoomAuto),$(window).on("resize",function(){zoomAuto(),boxResize()})
var debug=!1,loggedin=!1,appxclientversion=[3,4],appxserverversion=null,client_init_sent=!1,appx_session,localos_session,localos_access=!1,appx_access=!1,xTriggered=0,optionTriggered=0,digits=[],basefontsize=14
$(document).ready(function(){debug?$("#log").show():$("#log").hide(),$(document.body).append($("<span>").attr("id","fontcheck").css({display:"none","font-family":"courier","font-size":"14px",padding:"0px",margin:"0px","box-sizing":"border-box"}).text("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX")),$("#fontcheck").width()>800&&(basefontsize=14*(1-($("#fontcheck").width()-800)/$("#fontcheck").width())),$("#fontcheck").remove()
var o="MozWebSocket"in window?"MozWebSocket":"WebSocket"in window?"WebSocket":null
if(null!=o)if(appendMessage("WebSockets --  are fully supported in this browser."),localStorage.newsession){appxNewSession=!0
var e=JSON.parse(localStorage.newsession)
delete localStorage.newsession,appx_session=new APPX(appxConnectorHost,appxConnectorPort,appxConnectorMongoPort,appxConnectorPath,appxEncryption,basefontsize,appxLoginFormMinified),appx_session.startupinfo=e,setTimeout(function(){sendappxnewsessionlogin(e.remoteHost,e.remotePort,e.remoteUser,e.remotePassword,e)},1500)}else appx_session=new APPX(appxConnectorHost,appxConnectorPort,appxConnectorMongoPort,appxConnectorPath,appxEncryption,basefontsize,appxLoginFormMinified)
else appendMessage(webSocketError)
$("#localos_access").removeClass().html("<a href='"+appxClientRoot+"/"+appx_session.localInstaller+"'>Local</a>"),loadLanguage(),void 0==appxClientRoot&&alert(appx_session.language.alerts.rootError)}),$(function(){window.onbeforeunload=function(o){if(appx_session.connected)return o.returnValue="This will end your Appx session!","This will end your Appx session!"},window.onunload=function(o){appx_session.connected&&appxwidgetcallback(356),closeSession()},console.log("%cYou should only be here under the direction of APPX Technical Support. Please contact your System Administrator if this is not the case.","background-color: black; color: yellow; font-size: large")})
